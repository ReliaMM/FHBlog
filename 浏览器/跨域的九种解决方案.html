<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>跨域的九种解决方案 | 风禾风禾呀</title>
    <meta name="description" content="风禾风禾呀">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/FHBlog/assets/img/zebra-3.png">
    
    <link rel="preload" href="/FHBlog/assets/css/0.styles.bbeac537.css" as="style"><link rel="preload" href="/FHBlog/assets/js/app.c28660a9.js" as="script"><link rel="preload" href="/FHBlog/assets/js/2.e5136842.js" as="script"><link rel="preload" href="/FHBlog/assets/js/20.f98e98be.js" as="script"><link rel="preload" href="/FHBlog/assets/js/3.8bc07ed0.js" as="script"><link rel="prefetch" href="/FHBlog/assets/js/10.8136d8ab.js"><link rel="prefetch" href="/FHBlog/assets/js/11.e1bf2f4e.js"><link rel="prefetch" href="/FHBlog/assets/js/12.c9de541d.js"><link rel="prefetch" href="/FHBlog/assets/js/13.229dffde.js"><link rel="prefetch" href="/FHBlog/assets/js/14.ebebfd07.js"><link rel="prefetch" href="/FHBlog/assets/js/15.dd4cc9a2.js"><link rel="prefetch" href="/FHBlog/assets/js/16.079da3ab.js"><link rel="prefetch" href="/FHBlog/assets/js/17.8d982329.js"><link rel="prefetch" href="/FHBlog/assets/js/18.377d9647.js"><link rel="prefetch" href="/FHBlog/assets/js/19.cbef7763.js"><link rel="prefetch" href="/FHBlog/assets/js/21.a2db72ca.js"><link rel="prefetch" href="/FHBlog/assets/js/22.4ce08a7d.js"><link rel="prefetch" href="/FHBlog/assets/js/4.f90044f4.js"><link rel="prefetch" href="/FHBlog/assets/js/5.bdf09a12.js"><link rel="prefetch" href="/FHBlog/assets/js/6.02e477d8.js"><link rel="prefetch" href="/FHBlog/assets/js/7.150b3ea5.js"><link rel="prefetch" href="/FHBlog/assets/js/8.b2918a25.js"><link rel="prefetch" href="/FHBlog/assets/js/9.8703a470.js">
    <link rel="stylesheet" href="/FHBlog/assets/css/0.styles.bbeac537.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FHBlog/" class="home-link router-link-active"><img src="/FHBlog/assets/img/zebra-3.png" alt="风禾风禾呀" class="logo"> <span class="site-name can-hide">风禾风禾呀</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FHBlog/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FHBlog/vue/源码/一、Vue 源码之数据劫持.html" class="nav-link">
  源码
</a></li><li class="dropdown-item"><!----> <a href="/FHBlog/vue/vuex.html" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/FHBlog/vue/vue-router.html" class="nav-link">
  vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/FHBlog/js/JavaScript 原生方法模拟实现.html" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/FHBlog/浏览器/跨域的九种解决方案.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/FHBlog/安全/最基础的 Web 安全问题.html" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/FHBlog/服务器/基于 CentOS 7 搭建异常监控 Sentry.html" class="nav-link">
  服务器
</a></div> <a href="https://github.com/ReliaMM/FHBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FHBlog/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FHBlog/vue/源码/一、Vue 源码之数据劫持.html" class="nav-link">
  源码
</a></li><li class="dropdown-item"><!----> <a href="/FHBlog/vue/vuex.html" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/FHBlog/vue/vue-router.html" class="nav-link">
  vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/FHBlog/js/JavaScript 原生方法模拟实现.html" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/FHBlog/浏览器/跨域的九种解决方案.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/FHBlog/安全/最基础的 Web 安全问题.html" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/FHBlog/服务器/基于 CentOS 7 搭建异常监控 Sentry.html" class="nav-link">
  服务器
</a></div> <a href="https://github.com/ReliaMM/FHBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FHBlog/浏览器/浏览器缓存之强缓存与协商缓存.html" class="sidebar-link">浏览器缓存之强缓存与协商缓存</a></li><li><a href="/FHBlog/浏览器/跨域的九种解决方案.html" class="active sidebar-link">跨域的九种解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#同源策略" class="sidebar-link">同源策略</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#jsonp" class="sidebar-link">jsonp</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#cors" class="sidebar-link">CORS</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#http-proxy" class="sidebar-link">http-proxy</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#正反代理" class="sidebar-link">正反代理</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#postmessage" class="sidebar-link">PostMessage</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#-3" class="sidebar-link"></a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#nginx" class="sidebar-link">Nginx</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#document-domain" class="sidebar-link">document.domain</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#window-name" class="sidebar-link">window.name</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#location-hash" class="sidebar-link">location.hash</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#websocket" class="sidebar-link">WebSocket</a></li><li class="sidebar-sub-header"><a href="/FHBlog/浏览器/跨域的九种解决方案.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="跨域的九种解决方案"><a href="#跨域的九种解决方案" class="header-anchor">#</a> 跨域的九种解决方案</h1> <p><a name="T5yJO"></a></p> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>跨域问题在开发中很常见，目前很多框架都我们封装好了具体解决方案。我们只需要直接配置一个属性、或是调用一个方案等等，即可完成跨域。解决跨域的方案不唯一，下面我们来看一下跨域有几种解决方案。<br></p> <p><a name="LyoNG"></a></p> <h2 id="同源策略"><a href="#同源策略" class="header-anchor">#</a> 同源策略</h2> <p>提到跨域就要有同源策略了。同时满足 <code>协议</code> <code>域名</code> <code>端口号</code> 一致，则两个页面具有相同的源，才算是同一个域名，否则均认为需要做跨域的处理。</p> <p><a name="vniTo"></a></p> <h2 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> jsonp</h2> <p>提到跨域不得不提 <code>jsonp</code> ，该方法兼容性好，但不支持 <code>POST</code> ，且不安全会造成 <code>XSS</code> 攻击。具体前后端 <code>Demo</code>  完整实现可见 <a href="https://github.com/ReliaMM/FrontEndInterView/tree/master/JS/%E5%9F%BA%E7%A1%80/%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener noreferrer">链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>下面只写出核心代码，若后端不自行实现，可拿百度搜索接口来测试；</p> <p><a name="Ixz2e"></a></p> <h3 id="前端入门助理解版"><a href="#前端入门助理解版" class="header-anchor">#</a> 前端入门助理解版</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">searchBaidu</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://www.baidu.com/sugrec?json=1&amp;prod=pc&amp;wd=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;bs=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;cb=jsonpCallBack</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 百度接口测试</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">jsonpCallBack</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> g <span class="token punctuation">}</span> <span class="token operator">=</span> res
  <span class="token keyword">const</span> list <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> q <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">)</span>
  <span class="token keyword">const</span> domList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#selectWrap'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>domList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="CPsdl"></a></p> <h3 id="前端-promise-封装版"><a href="#前端-promise-封装版" class="header-anchor">#</a> 前端 promise 封装版</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">searchBaidu</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      wd<span class="token operator">:</span> value<span class="token punctuation">,</span>
      bs<span class="token operator">:</span> value<span class="token punctuation">,</span>
      json<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      prod<span class="token operator">:</span> <span class="token string">'pc'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://www.baidu.com/sugrec</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    cb<span class="token operator">:</span> <span class="token string">'jsonpCallBack'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 运用 promise 封装，即可用 then 回调实现</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> g <span class="token punctuation">}</span> <span class="token operator">=</span> res
    <span class="token keyword">const</span> list <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> q <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">)</span>
    <span class="token keyword">const</span> domList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#selectWrap'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>domList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// promise 封装</span>
<span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> cb <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  params <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>params<span class="token punctuation">,</span> cb <span class="token punctuation">}</span>

  <span class="token keyword">let</span> paramsStringify <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    element<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paramsStringify<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">[</span>cb<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="rJf9R"></a></p> <h3 id="后端-node-js-实现"><a href="#后端-node-js-实现" class="header-anchor">#</a> 后端 Node.js 实现</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>const url <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

require<span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>.createServer<span class="token punctuation">((</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
		const data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域&quot;</span>,<span class="token string">&quot;p&quot;</span>:false,<span class="token string">&quot;g&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_1&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域解决方案&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_2&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域物流&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_3&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域立案&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_4&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域是什么&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_5&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域请求&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_6&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨越速运单号查询&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_7&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域问题&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_8&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨越速运&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_9&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域访问&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;sug&quot;</span>,<span class="token string">&quot;sa&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;s_10&quot;</span>,<span class="token string">&quot;q&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;跨域立案诉讼服务规定&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;slid&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10238582904221488926&quot;</span><span class="token punctuation">}</span>
    const callback <span class="token operator">=</span> url.parse<span class="token punctuation">(</span>req.url, <span class="token boolean">true</span><span class="token punctuation">)</span>.query.cb<span class="token punctuation">;</span>
    res.writeHead<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res.end<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{</span>callback<span class="token punctuation">}</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span>JSON.stringify<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 后端实现最核心

<span class="token punctuation">}</span><span class="token punctuation">)</span>.listen<span class="token punctuation">(</span><span class="token number">9000</span>, <span class="token string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span><span class="token string">'启动服务，监听 127.0.0.1:9000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="lCE1G"></a></p> <h3 id="实践代码"><a href="#实践代码" class="header-anchor">#</a> 实践代码</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582186386788-fe7f9085-7409-404e-ae08-7ed31c1576fb.png#align=left&amp;display=inline&amp;height=416&amp;name=image.png&amp;originHeight=1572&amp;originWidth=2816&amp;size=839738&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="XOUkC"></a></p> <h3 id="效果演示"><a href="#效果演示" class="header-anchor">#</a> 效果演示</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582119120846-9d26da07-f03d-4695-91db-cc201c718036.png#align=left&amp;display=inline&amp;height=385&amp;name=image.png&amp;originHeight=1264&amp;originWidth=2448&amp;size=231075&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"><br></p> <p><a name="H7hYg"></a></p> <h2 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h2> <p>普通跨域请求：只服务端设置头 <code>Access-Control-Allow-Origin</code>  即可，前端无须设置。
<a name="mOGs5"></a></p> <h3 id=""><a href="#" class="header-anchor">#</a></h3> <p><a name="MnXCT"></a></p> <h3 id="实践代码-2"><a href="#实践代码-2" class="header-anchor">#</a> 实践代码</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582184610518-6b1bbc09-66f4-4bdb-9db7-4794d2288b76.png#align=left&amp;display=inline&amp;height=321&amp;name=image.png&amp;originHeight=1186&amp;originWidth=2756&amp;size=432448&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="fxq6g"></a></p> <h3 id="效果演示-2"><a href="#效果演示-2" class="header-anchor">#</a> 效果演示</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582168542720-f5a5ba33-8a07-46f9-8fb7-703f4efe5d35.png#align=left&amp;display=inline&amp;height=446&amp;name=image.png&amp;originHeight=1056&amp;originWidth=1768&amp;size=160416&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="DeKfi"></a></p> <h3 id="框架跨域应用"><a href="#框架跨域应用" class="header-anchor">#</a> 框架跨域应用</h3> <ul><li>Egg.js 实现跨域具体方案 <a href="https://www.npmjs.com/package/egg-cors" target="_blank" rel="noopener noreferrer">egg-cors<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><a name="0ksDQ"></a></p> <h2 id="http-proxy"><a href="#http-proxy" class="header-anchor">#</a> http-proxy</h2> <p><a name="6ogXj"></a></p> <h3 id="实践代码-3"><a href="#实践代码-3" class="header-anchor">#</a> 实践代码</h3> <p>这里服务没有基于 <code>Koa</code> 、<code>Express</code>   来写，采用无框架 <code>Node.js</code>   写法。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582183429585-513fa553-516d-4f89-a3f2-c6c3f53b8bb7.png#align=left&amp;display=inline&amp;height=335&amp;name=image.png&amp;originHeight=1186&amp;originWidth=2642&amp;size=462658&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="gj9yA"></a></p> <h3 id="效果演示-3"><a href="#效果演示-3" class="header-anchor">#</a> 效果演示</h3> <ul><li>可以看到在 <code>localhost:8080</code>  端口号请求，可以获取到 <code>localhost:9000</code>  的数据；</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582182917662-2fccca45-79e9-48d0-88fc-e781051cba6a.png#align=left&amp;display=inline&amp;height=538&amp;name=image.png&amp;originHeight=1338&amp;originWidth=1856&amp;size=179905&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"><br></p> <p><a name="A5ZfH"></a></p> <h3 id="框架跨域应用-2"><a href="#框架跨域应用-2" class="header-anchor">#</a> 框架跨域应用</h3> <p><code>vue</code> 、 <code>react</code>  的脚手架已经帮我们将跨域配置简化抽离，相信也是基于 <code>http-proxy</code>  原理进行跨域访问的，只是框架都帮我们封装好了，让我们使用起来更简单。</p> <ul><li><code>vue.config.js</code>  一部分</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    host<span class="token operator">:</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>
    disableHostCheck<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/mock'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'^/mock'</span><span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>     
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li><code>React</code>  中的 <code>setupProxy.js</code>  很清晰基于 <code>http-proxy-middleware</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">REACT_APP_PROXY_URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'/mock'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    target<span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3001'</span><span class="token punctuation">,</span>
    secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'^/mock'</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">REACT_APP_PROXY_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">'http://xxxx.xxx.com'</span><span class="token punctuation">,</span>
    secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">REACT_APP_PROXY_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>Umi.js</code>  配置的跨域， 在 <code>config.ts</code>  文件中</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token constant">REACT_APP_PROXY_URL</span><span class="token punctuation">,</span>
  <span class="token constant">REACT_APP_PROXY_BASE_URL</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>
<span class="token comment">/// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">/// ....,</span>
  proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">REACT_APP_PROXY_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token constant">REACT_APP_PROXY_BASE_URL</span><span class="token punctuation">,</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">REACT_APP_PROXY_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="mn9Ru"></a></p> <h2 id="正反代理"><a href="#正反代理" class="header-anchor">#</a> 正反代理</h2> <p>通过上面我们知道通过 <code>CORS</code>  方式的代码，前端 <code>HTML</code>  直接请求 <code>localhost:9000</code>  地址的数据，<br>而 <code>Proxy</code>  方式，前端 <code>HTML</code>  还是请求 <code>localhost:8080</code>  地址的数据。 <code>CORS</code>  方式成为正向代理， <code>Proxy</code>  方式成为反向代理。</p> <blockquote><p>总结一句话到底是正向代理还是反向代理，只需要判断客户端知不知道真正返回数据的服务器在谁，知道就是正向代理，不知道就是反向代理</p></blockquote> <p><a name="s1AyI"></a></p> <h2 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> PostMessage</h2> <p><code>PostMessage</code>  是 <code>HTML5</code>  中的 <code>API</code> ，且是为数不多可以跨域操作的 <code>Window</code>  属性之一。
<a name="Mrnki"></a></p> <h3 id="当前页面与打开新窗口-进行数据传输"><a href="#当前页面与打开新窗口-进行数据传输" class="header-anchor">#</a> 当前页面与打开新窗口 进行数据传输</h3> <ul><li>实践代码
<ul><li>前提：在 <code>from</code>  中打开新窗口  <code>to</code> ,  <code>from</code>  在 <code>8080</code>  端口号访问， <code>to</code>  在 <code>9000</code>  端口号访问；</li> <li><code>from</code>  通过找到 <code>window.open</code>  返回得到 <code>to</code> 的 <code>window</code> ，在通过 <code>postMessage</code>  传递消息；</li> <li><code>to</code>  通过监听 <code>message</code>  得到数据；</li></ul></li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582190506660-373992a9-d472-4964-95c0-7a922131f2b3.png#align=left&amp;display=inline&amp;height=391&amp;name=image.png&amp;originHeight=1260&amp;originWidth=2402&amp;size=425297&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <ul><li>效果图</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582190418363-cc6309ca-c0fc-4bbc-86c9-c4a5fe4e55c4.png#align=left&amp;display=inline&amp;height=204&amp;name=image.png&amp;originHeight=680&amp;originWidth=2492&amp;size=94081&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"> <a name="zvhgD"></a></p> <h3 id="-2"><a href="#-2" class="header-anchor">#</a></h3> <p><a name="Kfrf1"></a></p> <h3 id="页面与嵌套-iframe-消息传递"><a href="#页面与嵌套-iframe-消息传递" class="header-anchor">#</a> 页面与嵌套 <code>iframe</code>  消息传递</h3> <ul><li>实践代码
<ul><li><code>from</code>  嵌套 <code>to</code> , <code>from</code>  在 <code>8080</code>  端口号访问， <code>to</code>  在 <code>9000</code>  端口号访问。</li> <li><code>from</code>  通过找到 <code>to</code>  的 <code>iframe</code>  得到 <code>window</code>  通过 <code>postMessage</code>  传递消息</li> <li><code>to</code>  通过监听 <code>message</code>  得到数据</li></ul></li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582189759407-6525ef5f-68ef-4ecd-9852-05d45a8ce658.png#align=left&amp;display=inline&amp;height=727&amp;name=image.png&amp;originHeight=1454&amp;originWidth=2456&amp;size=503400&amp;status=done&amp;style=none&amp;width=1228" alt="image.png"></p> <ul><li>效果图</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582190636904-cdea7c15-58e3-4545-a675-a856c4129a14.png#align=left&amp;display=inline&amp;height=377&amp;name=image.png&amp;originHeight=754&amp;originWidth=1274&amp;size=53016&amp;status=done&amp;style=shadow&amp;width=637" alt="image.png"><br></p> <p><a name="IJ2XV"></a></p> <h2 id="-3"><a href="#-3" class="header-anchor">#</a></h2> <p><a name="lH9Vi"></a></p> <h2 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h2> <p><a name="QShvy"></a></p> <h3 id="未配置前"><a href="#未配置前" class="header-anchor">#</a> 未配置前</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">8888</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
  <span class="token keyword">location</span> <span class="token operator">/</span>mystatus <span class="token punctuation">{</span>
    <span class="token keyword">stub_status</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>www<span class="token operator">/</span>test<span class="token punctuation">;</span>
    <span class="token keyword">index</span>  <span class="token number">1.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582192317088-5b866362-3462-413e-9b73-12a26f5ba190.png#align=left&amp;display=inline&amp;height=100&amp;name=image.png&amp;originHeight=200&amp;originWidth=2856&amp;size=65821&amp;status=done&amp;style=none&amp;width=1428" alt="image.png"></p> <p><a name="jpUVm"></a></p> <h3 id="配置后"><a href="#配置后" class="header-anchor">#</a> 配置后</h3> <ul><li>重点在：add_header &quot;Access-Control-Allow-Origin&quot; &quot;*&quot;;</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">8888</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
  <span class="token keyword">location</span> <span class="token operator">/</span>mystatus <span class="token punctuation">{</span>
    <span class="token keyword">stub_status</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>www<span class="token operator">/</span>test<span class="token punctuation">;</span>
    <span class="token keyword">index</span>  <span class="token number">1.</span>html<span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>页面请求该网址接口</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582192986069-ed0acb1c-0832-4421-92d8-9ed56a8805a2.png#align=left&amp;display=inline&amp;height=481&amp;name=image.png&amp;originHeight=1168&amp;originWidth=1810&amp;size=165930&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="78fj4"></a></p> <h2 id="document-domain"><a href="#document-domain" class="header-anchor">#</a> document.domain</h2> <p>该方式只能用于<strong>二级域名</strong>相同的情况下，比如 <code>a.test.com</code> 和 <code>b.test.com</code> 适用于该方式。<br>只需要给页面添加 <code>document.domain = 'test.com'</code> 表示二级域名都相同就可以实现跨域</p> <p><a name="qvsmt"></a></p> <h3 id="实践代码-4"><a href="#实践代码-4" class="header-anchor">#</a> 实践代码</h3> <ul><li>首先在本地 <code>host</code>  配置 两个域名指向 <code>127.0.0.1</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1 b.test.com
<span class="token number">127.0</span>.0.1 a.test.com
</code></pre></div><ul><li>接这开启两个服务 <code>8080</code>  端口给到 <code>a.html</code>  页面， <code>9000</code>  端口给到 <code>b.html</code>  页面</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582207394221-d39a0042-a188-44dd-8472-ec7c8384b130.png#align=left&amp;display=inline&amp;height=353&amp;name=image.png&amp;originHeight=1046&amp;originWidth=2208&amp;size=275545&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="3JEqn"></a></p> <h3 id="效果演示-4"><a href="#效果演示-4" class="header-anchor">#</a> 效果演示</h3> <ul><li>未加 domain 之前</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582207276796-27ab3185-4445-434c-8143-b7e3acc143db.png#align=left&amp;display=inline&amp;height=365&amp;name=image.png&amp;originHeight=1124&amp;originWidth=2296&amp;size=175925&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <ul><li>添加 domain 之后</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582207318687-567e8eaf-e9b4-4be5-b246-60054bde9b70.png#align=left&amp;display=inline&amp;height=388&amp;name=image.png&amp;originHeight=1124&amp;originWidth=2160&amp;size=137337&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"> <a name="ldNm4"></a></p> <h2 id="window-name"><a href="#window-name" class="header-anchor">#</a> window.name</h2> <p><a name="xG49i"></a></p> <h3 id="实践代码-5"><a href="#实践代码-5" class="header-anchor">#</a> 实践代码</h3> <ul><li><code>a1.html</code> <code>a2.html</code>  部署在同域 <code>8080</code>  端口下， <code>b.html</code>  部署在 <code>9000</code>  端口上</li> <li><code>a1.html</code> 的 <code>iframe</code>  嵌套不同域 <code>b.html</code></li> <li>将 <code>b.html</code>  中数据挂载到 <code>window.name</code>  上</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582209225091-94bfc8bd-79ab-4798-936a-fbd73d4086f6.png#align=left&amp;display=inline&amp;height=345&amp;name=image.png&amp;originHeight=1112&amp;originWidth=2402&amp;size=322642&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="3F7Du"></a></p> <h3 id="效果演示-5"><a href="#效果演示-5" class="header-anchor">#</a> 效果演示</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582209323248-a8bc004f-d1ab-4b1f-83fa-89e7693fb55d.png#align=left&amp;display=inline&amp;height=384&amp;name=image.png&amp;originHeight=1112&amp;originWidth=2160&amp;size=133061&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="AMm0a"></a></p> <h2 id="location-hash"><a href="#location-hash" class="header-anchor">#</a> location.hash</h2> <p><a name="fz3h9"></a></p> <h3 id="代码实践"><a href="#代码实践" class="header-anchor">#</a> 代码实践</h3> <ul><li><code>a1.html</code> <code>a2.html</code>  部署在同域 <code>8080</code>  端口下， <code>b.html</code>  部署在 <code>9000</code>  端口上</li> <li><code>a1.html</code> 的 <code>iframe</code>  嵌套不同域 <code>b</code> ，并将传递数据放置到 <code>hash</code>  上</li> <li>在 <code>b.html</code>  将监听到的 <code>hash</code>  值经过处理，在创建 <code>iframe</code> ， <code>src</code>  指向 <code>a2</code></li> <li>此时 <code>a2</code>  可以将自己 <code>location.hash</code>  给到 <code>window.parent.parent.location.hash</code></li></ul> <p><br><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582210718652-18f20234-c819-463e-9248-a1aed535b6a3.png#align=left&amp;display=inline&amp;height=281&amp;name=image.png&amp;originHeight=928&amp;originWidth=2466&amp;size=318681&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="qTBYs"></a></p> <h3 id="效果演示-6"><a href="#效果演示-6" class="header-anchor">#</a> 效果演示</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582210647583-864c2269-b7de-4c85-b8ca-97207f466f9d.png#align=left&amp;display=inline&amp;height=300&amp;name=image.png&amp;originHeight=958&amp;originWidth=2380&amp;size=148243&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="WIaCL"></a></p> <h2 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h2> <p><a name="k4rRe"></a></p> <h3 id="实践代码-6"><a href="#实践代码-6" class="header-anchor">#</a> 实践代码</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582421344166-b13701b0-3d0d-4106-876b-f00365814c74.png#align=left&amp;display=inline&amp;height=399&amp;name=image.png&amp;originHeight=980&amp;originWidth=1834&amp;size=230943&amp;status=done&amp;style=shadow&amp;width=746" alt="image.png"></p> <p><a name="BAUBU"></a></p> <h3 id="效果演示-7"><a href="#效果演示-7" class="header-anchor">#</a> 效果演示</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582421396725-15bc7e52-0fb3-4860-834f-26a5f94a410c.png#align=left&amp;display=inline&amp;height=332&amp;name=image.png&amp;originHeight=664&amp;originWidth=634&amp;size=49682&amp;status=done&amp;style=shadow&amp;width=317" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2020/png/424608/1582421419501-8dfc4be9-9d3c-4550-9aca-cae6cf2f5fbd.png#align=left&amp;display=inline&amp;height=107&amp;name=image.png&amp;originHeight=214&amp;originWidth=468&amp;size=13055&amp;status=done&amp;style=shadow&amp;width=234" alt="image.png"></p> <p><a name="kJo6X"></a></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>由此可看跨域种类多种多样，目前最常用的是 <code>proxy</code> ， <code>Webpack</code>  已经帮我们封装好， <code>Vue</code> 、 <code>React</code>  等脚手架配置起来也相当方便， <code>window.name</code> <code>domain</code> <code>hash</code>  都与 <code>iframe</code> 相干，目前不常用。 <code>CORS</code> 方案也有封装好，方便项目中使用。大家一起来手动实践一下吧，相信会有所收获；当然不止这些例子，还有更多等着你去挖掘；</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ReliaMM/FHBlog/edit/master/docs/浏览器/跨域的九种解决方案.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FHBlog/浏览器/浏览器缓存之强缓存与协商缓存.html" class="prev">
        浏览器缓存之强缓存与协商缓存
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/FHBlog/assets/js/app.c28660a9.js" defer></script><script src="/FHBlog/assets/js/2.e5136842.js" defer></script><script src="/FHBlog/assets/js/20.f98e98be.js" defer></script><script src="/FHBlog/assets/js/3.8bc07ed0.js" defer></script>
  </body>
</html>
